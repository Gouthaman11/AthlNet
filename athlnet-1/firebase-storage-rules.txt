// Firebase Storage Security Rules - UPDATED VERSION FOR MESSAGING
// Copy these rules to your Firebase Console -> Storage -> Rules

rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Allow any authenticated user to read and write to posts folder
    match /posts/{userId}/{filename} {
      allow read, write: if request.auth != null;
    }
    
    // Allow any authenticated user to read and write to profiles folder
    match /profiles/{userId}/{filename} {
      allow read, write: if request.auth != null;
    }
    
    // Messages folder - users can upload files for their own messages
    match /messages/{userId}/{filename} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Achievements folder - users can manage their own achievement files
    match /achievements/{userId}/{filename} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Fallback: Allow all authenticated users read access
    match /{allPaths=**} {
      allow read: if request.auth != null;
    }
  }
}

// Instructions:
// 1. Go to Firebase Console -> Your Project (athlnet) -> Storage
// 2. Click on "Rules" tab
// 3. Replace the existing rules with the above rules
// 4. Click "Publish" to apply the changes
//
// These rules allow:
// - Authenticated users to upload message attachments to their own folder
// - Authenticated users to read all uploaded files
// - Users can only write to their own user folders for security